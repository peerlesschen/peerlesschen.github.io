---
layout: post
title: 响应式 Web 设计 
subtitle: 响应式设计三大利器及设计思路
date: '2016-04-22 14:19:01 +0800'
catalog: study
keyword: HTML, CSS, JavaScript, 响应式设计, Web, 流动布局, 媒介查询, 响应式多媒体, 移动端
excerpt: 现今，人们上网的设备迥异。Web以其固有的灵活性和可塑性，普遍的存在于这些设备中。响应式Web设计使我们的Web站点能从容应对不同的设备。本文介绍了响应式设计的三大利器——流动布局、媒介查询和响应式多媒体，以及响应式设计过程中的一些基本思路。
tags: [CSS, JavaScript, 响应式]
categories: articles study web-front-end
header_img: /assets/imgs/posts/implementing-responsive-web-design/1.jpg
---

## 让 Web 站点变化起来

现今，人们能上网的设备涵盖了智能手表、手机、平板、PC机等。它们不仅在屏幕显示尺寸上差别很大，而且在操作系统、配置、性能等方面也有所不同。Web以其固有的灵活性和可塑性，普遍的存在于这些设备中。Web几乎无处不在。

那么问题来了，不同设备的环境迥异。面对分化如此严重的设备集合，我们是不是需要单独为每类设备进行Web开发呢？早期的解决方案中，确实有人建立两个站点，以分别满足手机端和PC端的的请求。但是这种方案耗费资源多，考虑到庞大设备集，它并不是理想的解决方案。

所幸的是，强大的Web给我们提供了更为合理的解决方案，那就是响应式Web。响应式设计并不是针对某一特定的设备进行的，相反，它所主张的是以设备无关的方法进行Web设计。通过响应式设计，Web站点就像会72变化般，能够在不同的设备自行变化，始终有不错的显示效果。

我初次接触响应式设计是因为接到一个必须满足手机端和PC端的Web项目。在项目进行过程中，我通过上网和阅读书籍来学习响应式设计及实现。在这期间，我拜读了Tim Kadlec的《Implementing Responsive Design》。我阅读的是侯鸿儒的译本。该书对我学习响应式设计有很大的帮助，本文很多知识点都是结合该书介绍和自己实践经验得到的。希望对大家学习响应式设计有所帮助。

## 响应式设计的三大利器

这里，我想向大家介绍实现响应式Web的三大利器，它们分别是流动布局、媒介查询和响应式多媒体。如果你能在自己的Web站点中充分使用这三门利器，那么你的站点也就能拥有不错的变化能力。

### 一、流动布局

#### 四种基础布局

以下是四种基础的布局类型：固定布局、流动布局、弹性布局和混合布局。

- **固定布局**：在固定布局中，页面宽度通常被指定为特定大小的像素，即宽度多以`px`作为长度单位。这可以准确的描绘布局，但是缺点也可想而知，那就是适应性极差。举个例子，body的宽度可以如下指定，那么body的宽度无论在何种设备上，都为960px。

```css
body {
    width: 960px;
}
```

- **流动布局**：度量的单位不再是像素，而是百分比`%`。百分比表示该块元素占容器的百分之几。这种布局可以避免出现讨厌的水平滚动条，元素的宽度会根据窗口的宽度自动调整。比如下面例子中，表示一个占容器宽度60%的内容栏，和一个占容器宽度30%的边栏。无论何种设备下，内容栏和边栏显示比例都是6比3。

```css
body {
    width: 100%;
}  /* body 主容器，设置为100% */

.content {
    width: 60%;
} /* 内容栏占主容器的60% */

.side {
    width: 30%;
} /* 边栏占主容器的30% */
```

- **弹性布局**：与流体布局类似，不过度量单位不同，通常使用`em`作为度量单位。1em相当于当前字体大小，若当前字体大小为16px，则1em表示16px，2em表示32px，2.5em表示40px，以此计算。用户可以根据自己需要调整字体大小，那么布局大小也会随之改变。弹性布局还是可能出现讨厌的水平滚动条。举个例子，下面的内容栏和边栏的宽度虽然可以根据字体大小有所改变，但灵活性有限，并不能很好的做到适应各种尺寸。

```css
body {
    font-size: 16px;
}  /* 设置字体大小为16px */

.content {
    width: 50em;
} /* 内容栏占主容器的宽度为 800px （16*50） */

.side {
    width: 18em;
} /* 边栏占主容器的宽度为 288px （16*18） */
```
- **混合布局**：结合了上面提到的两种或两种以上的布局方式。

通过对四种布局的介绍，我们可以得出的结论是流动布局更能适应不同尺寸的设备。利用`%`定义布局是让我们的布局响应变化的重要方式。实现流动布局也有很多小技巧，例如你要将一个图片或者其他元素填满整个域，可以使用`width: 100%;`设置；还有一些属性也是可以好好利用的，诸如`max-width`、`min-width`等，将它们和`%`结合起来使用可以让你的流体布局更具掌控性。

#### 流动布局的字体大小

要想更好的拥抱Web的流动性，那么设计中能够灵活地改变字体大小也是很重要的。Web中有很多方法可以改变字体大小，这里介绍四种方法：像素、em、百分比还有rem。

- 像素：以`px`作为字体大小单位的方法。这种方法能对字体进行精确控制，可不考虑级联——父元素的字体大小对子元素没有影响，然而灵活性差。
- em：以em作为字体大小单位的方法。和前面介绍的一样，1em等于默认字体大小，2em为两倍默认字体大小。以em为单位的字体可缩放，并且em是级联的。如下例子中：

```html
<body>
    <h1>标题<span>内嵌内容</span></h1>
    <p>段落</p>
</body>
```

```css
body {
    font-size: 16px; /* 设置基准字体 */
}
h1 {
    font-size: 1.5em; /* 24px / 16px */
}
span {
    font-size: 0.6666666667em; /* 16px / 24px */
}
/* 由于级联作用，这里span基准值变为24px */
```
- 百分比：以百分比作为字体大小单位的方法。与使用em一样，也是可缩放且为级联的。100%相当于1em，200%相当于2em，以此类推。可以在body元素上以百分比为单位指定默认基准字体大小，一般默认字体大小为16px。

```css
body {
    font-size: 100%;
}
```
- rem：以rem作为字体大小单位的方法。rem与em区别在于：rem的大小与根元素（HTML元素）有关。可使用rem避免发生在嵌套元素中的级联问题。比如下面的CSS代码。

```css
html {
    font-size: 100%; /* 等于16px，根字体大小 */
}
h1 {
    font-size: 1.5em; /* 24px / 16px */
}
span {
    font-size: 16px; /* 考虑兼容问题，这个为候补属性 */
    font-size: 1rem; /* 16px / 16px */
}
/* 以根元素字体16px为基准 */
```

大多数情况下，使用百分比和em可以使我们的布局适应不同的设备尺寸。流动布局是我们设计响应站点最佳的布局选择。而rem由于兼容问题，暂时还是要慎用，但是rem未来潜力巨大。另外，也可以通过定义网格、box-sizing属性、表格布局（display属性的table-cell值）来定义我们的布局，达到我们想要的响应式布局。

### 二、媒介查询

媒介查询可以让我们根据在特定环境下查询到的各种属性值——比如分辨率、色彩深度、高度和宽度等，来决定应用什么样的样式。通过使用媒介查询，可以让我们的布局更灵活。

#### 为你的站点设定视口

再此之前，我们要了解一下两种像素：**设备像素**和**CSS像素**。**设备像素（device pixels）**是指与硬件设备直接相关的像素，是真实的屏幕设备中的像素点。比如说，电脑的显示器参数中，最佳分辨率是1920*1080，那么指的就是这个显示器在屏幕上用于显示的实际像素点，也就是设备像素。**CSS像素（CSS pixels）**是指网页布局和样式定义所使用的像素，也就是说，CSS代码中的px，对应的是CSS像素。这两种像素存在可变的转化关系。在100%缩放比例下，1个CSS像素等于1个设备像素。

那么什么是视口（viewpoint）呢？在桌面浏览器中，视口简单的理解就是浏览器的可视区域，也指浏览器的宽度，视口表现的像是HTML文档之上的一个块元素，它限制并确定宽度，但不属于HTML结构，不能被设置样式。但在手机端，视口则相对复杂了。手机浏览器中，视口被划分为了两个：**可见视口（visual viewport）**和**布局视口（layout viewport**）。**可见视口**是指当前在手机屏幕上显示的部分，缩放时可见视口尺寸（CSS像素）会变化。**布局视口**则主要用于元素布局和尺寸计算（百分比单位计算的基准值），而且比可见视口明显要更宽。**布局视口**宽度是由手机浏览器定义的，无论你缩放，滑动页面或者翻转手机屏幕，它都是不变的。

关于视口相关概念，我参考了文章[A tale of two viewports](http://www.quirksmode.org/mobile/viewports.html)。觉得英文看着吃力的小伙伴，也可以看看该文章的中文译文[两个viewport的故事](http://weizhifeng.net/viewports.html)。个人觉得写的不错，推荐大家看看，加深理解。

我们可以通过视口元标签来修改手机中的布局视口。这最初是有Safari引入的，如今这一设置已经普遍被各类手机浏览器认可。如下例子，只需将它放进HTML文件中的head标签中即可生效。

```html
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
```

以下是对几个属性的说明：

- width属性可以让你将布局视口设置为某一特定宽度，也可以是设为设备屏幕宽度device-width，此时布局视口就等于设备屏幕宽度，即设备像素；
- height属性可以指定高度，但用的情况很少；
- user-scalable属性会告诉浏览器，是否允许用户在页面上进行缩放，默认值为yes；
- initial-scale属性可以设置页面初始化时的缩放层级；
- maximum-scale属性可以设置页面允许被放大的程度，取值范围为0.1-10；
- minimum-scale属性可以设置页面允许被缩小的程度，取值范围为0.1-10。

通过设定视口，我们可以让我们的Web网页摆脱需要“放大”页面后才能查看的情况，但是仅仅这样，页面像被揍扁了一样，接下来就需要媒介查询来帮忙了。

#### 使用媒介查询调整站点的设计

媒介查询可以通过询问浏览器来确定特定的表达式是否为真。如果为真，那么就加载该特定的样式，从而达到调整布局的目的。

媒介查询一般形式为：

```css
@media [only|not] type [and] (expr) {
    rules
}
```

一条媒介查询包含以下四个基本组成部分：

- 媒介类型：特定的目标设备类型。常见的诸如screen（彩色计算机屏幕）、print（打印）、handheld（手持设备）等。默认值为all，即所有设备。
- 媒介表达式：测试某一特性是否为真。常见特性有width、height、device-width、min-width、max-width、orientation、resolution和aspect-ratio等。其中orientation指定设备处于竖直或水平状态，值为portrait或landscape；resolution指定分辨率；aspect-ratio指定width和height的比值。
- 逻辑关键词：关键词有and、not、or和only等。你可以使用这些关键词创建出更多复杂的表达式。
- 规则：调整显示效果的基本样式，一些基本的CSS规则。

下面举个例子吧，以下的声明中，该样式值只会运用于电子屏幕且尺寸在480px至768px之间的设备，这样的设备基本上就是ipad等平板电脑了。

```css
a {
    color: blue;
}

@media only screen and (max-width:768px) and (min-width:480px) {
    a {
        color: blue;
    }
    h1 {
        font-size: 24px;
    }
}
```

#### 内嵌样式和外部样式

媒介查询既可以写在页面内部，也可以通过link元素的media属性被包含到页面中来。

- 内嵌样式：即将媒介查询包含到样式表中去，上面的例子即是如此。无论样式是否用到，都会下载下来，而且只需要一个HTTP请求即可。
- 外部样式：通过link元素加载特定样式表，在head元素中看到类似下面的代码：

```html
<link href="style.css" media="only screen and (min-width: 1300px)" />
```

外部样式使得文件变得很小，进而利于维护。事实上，为了最佳体验，在外部样式下，浏览器也会下载所有样式，以备使用。除非用only关键字排除的。

#### 设定必要的断点

到这里你已经了解了媒介查询的基本使用规则了。那么这一步，就是让你确定断点，把你的媒介查询划分不同的区间。常见的就是分为手机、ipad、普通PC和大屏幕。一般确定断点的传统方法就是使用一些固定标准宽度：320px、768px和1024px。但是具体的确定断点上，我觉得还是要根据你的网站内容来确定，这里并没有太多的限制。另外，这里我们也可以利用前面提到的em作为媒介查询的单位，这样更具灵活性。

### 三、响应式多媒体

前面的两大利器已经足够让你的页面在不同的尺寸上有很好的显示效果了。然而在多媒体方面，新的问题又来了。不同的设备拥有的能力和期待的显示效果不同，若对于多媒体资源不加处理的直接应用到不同的设备去，对于某些设备，网站的性能和视觉体验就可能大大打折。响应式多媒体是解决这一问题的办法之一。这里的多媒体主要是指音频、图片和视频等资源。响应式多媒体，希望达到的目的是不需要的尽量不加载，需要的加载最合适的，顾及网站的性能。由于在响应式多媒体方面，我现在并没有亲身的项目体验，理解还不算深，这里就简单介绍一下几种方法吧。之后有了实践经验再补充这部分内容。

#### 处理你的多媒体资源

首先你应该对你的多媒体资源进行相应的处理，将他们分化出适应不同设备的大小。例如图片可以进行相应的压缩处理，分化成S、L、XL、XXL等大小。音频和视频也可以做类似处理。可以选择在前端上传前进行压缩处理，也可以选择在后台统一处理，都是可行的。

#### 有选择的提供相应的多媒体资源

多样的资源我们准备好了，接下来就要告诉浏览器如何加载了，以下是几个策略。

-  运用HTML5的属性定义，在相应的元素中添加诸如`data-src`属性来表明图片的来源地址，之后又通过JavaScript代码读取这些属性，从而进行图片加载。这样做可以实现文本内容和图片的分批加载，浏览器会先加载全部文本内容再依次加载图片资源，从而提高体验。另外你也可以通过JavaScript指定加载特定尺寸的资源。

- matchMedia：这是JavaScript内部自带的方法函数，可以将CSS媒介查询作为参数传递给它，它会返回相应的媒介查询是否匹配，也因为这个方法，使得JavaScript也可以对媒介查询做判断，从而决定资源加载。看下面的例子，通过matchMedia判断后确定加载特定的资源。

```javascript
if (window.matchMedia("(min-width: 37.5em)").matches) {
    // load images
    ...
}
```

- 对于背景图片，我们可以在CSS样式中使用媒介查询告诉浏览器加载特定的背景图片。不只是背景图片，定义的Web字体等资源也可以这样做。看下面的例子，大屏幕设备加载大的背景图，小屏幕设备则加载较小的背景图。

```css
/* base styles */
@media all and (min-width: 53.75em) {
    body{
        background: url ('../imges/background_xl.png')
    }
}

@media all and (max-width: 53.75em) {
    body{
        background: url ('../imges/background_l.png')
    }
}
```

#### 矢量图形SVG

对于高分辨率屏幕上的显示问题，以及图片在不同尺寸屏幕上显示时的可伸缩问题，可以使用可伸缩矢量图形SVG作为一个解决方案。SVG是使用XML来定义的矢量图形，它可以不增加实际文件大小的前提下自如缩放，也可以运用编程来改变和调整它。网上有很多SVG教程，这里就不细说了，如果你有兴趣可以查找详细的SVG教程。

### 进行响应式设计

通过上面的学习，你现在已经掌握了响应式设计的三大利器。如何在实际建站中运用到这些利器也是很有方法的。可以从桌面端向下进行设计，也可以从移动端向上设计。

![](/assets/imgs/posts/implementing-responsive-web-design/2.gif)

考虑到移动端用户量爆炸式的增长，我一般是优先考虑手机端，即采用从移动端向上进行设计的方法。在设计过程中，先定义好普遍的样式。所谓普遍样式，就是作用全部或者多个设备的样式。然后根据自定义的断点，借助媒介查询针对特定设备做特定的样式定义。在定义样式过程中，尽可能的使用百分比、em等较灵活的单位，尽可能的采用流动布局。同时要学会利用JavaScript对样式进行调整，增强你的站点的响应能力。关于性能问题，这个就要多多考虑响应式多媒体了。

另外，你也可以通过一些工具来辅助你的响应式设计工作，比如线框图、模型和样式向导等。

本文只是我总结的关于响应式设计的一部分技术知识点。要做到响应式网站，我们要做的还有很多。性能方面、不同浏览器兼容等问题都是需要去考虑的，而且这些问题并不是那么容易解决的。总之，我们还是要不断地学习。







